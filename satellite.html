<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Street View & Place View</title>
  <style>
    html, body, #map-canvas {
      height: 100%;
      margin: 0px;
      padding: 0px;
    }
    #toggle-button {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1;
      background-color: #fff;
      padding: 10px;
      border: 1px solid #ccc;
      cursor: pointer;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgX0msxeBiaJSSwJsMnckbreKLGhJnLY0"></script>
  <script>
    var map;
    var streetViewService;
    var placeService;
    var toggleButton;
    var isStreetView = false;

    function initialize() {
      var params = getQueryParams();
      var initialLatLng = new google.maps.LatLng(params.lat, params.lon);

      var mapOptions = {
        center: initialLatLng,
        zoom: 14,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

      // Initialize street view service
      streetViewService = new google.maps.StreetViewService();

      // Initialize place service
      placeService = new google.maps.places.PlacesService(map);

      // Create a button to toggle between street view and place view
      toggleButton = document.createElement('div');
      toggleButton.id = 'toggle-button';
      toggleButton.textContent = 'Toggle View';
      toggleButton.onclick = toggleView;
      map.controls[google.maps.ControlPosition.TOP_LEFT].push(toggleButton);
    }

    function getQueryParams() {
      var params = {};
      var query = window.location.search.substring(1);
      var vars = query.split('&');
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (pair.length == 2) {
          params[pair[0]] = pair[1];
        }
      }
      return params;
    }

    function toggleView() {
      if (isStreetView) {
        toggleButton.textContent = 'Street View';
        showPlaceView();
      } else {
        toggleButton.textContent = 'Place View';
        showStreetView();
      }
      isStreetView = !isStreetView;
    }

    function showStreetView() {
      var params = getQueryParams();
      var initialLatLng = new google.maps.LatLng(params.lat, params.lon);

      // Use street view service to find the nearest street view panorama
      streetViewService.getPanorama({location: initialLatLng, radius: 50}, function(data, status) {
        if (status === 'OK') {
          map.setStreetView(new google.maps.StreetViewPanorama(document.getElementById('map-canvas')));
          map.getStreetView().setPosition(data.location.latLng);
        } else {
          alert('Street view not available at this location.');
        }
      });
    }

    function showPlaceView() {
      var params = getQueryParams();
      var initialLatLng = new google.maps.LatLng(params.lat, params.lon);

      // Use place service to find nearby places
      var request = {
        location: initialLatLng,
        radius: 500
      };
      placeService.nearbySearch(request, function(results, status) {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          map.setCenter(initialLatLng);
          map.setZoom(14);
          for (var i = 0; i < results.length; i++) {
            var place = results[i];
            new google.maps.Marker({
              map: map,
              position: place.geometry.location
            });
          }
        } else {
          alert('No places found nearby.');
        }
      });
    }

    google.maps.event.addDomListener(window, 'load', initialize);
  </script>
</head>
<body>
  <div id="map-canvas"></div>
</body>
</html>
